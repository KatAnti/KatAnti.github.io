"use strict";var ajax_more_bttn=document.getElementsByClassName("ajax_more_bttn"),catalog_sort_by_parametrs=document.querySelectorAll(".catalog_sort_by_parametrs a"),bindCurFavBtn=function(e,a){e.addEventListener("click",function(e){e.preventDefault();var t=e.target,r=t.dataset.route,n=document.querySelector(".header_favourite_count"),o=+n.innerHTML;t.classList.contains("active")?(t.classList.remove("active"),r=r.replace("product_add","product_delete"),o--):(t.classList.add("active"),r=r.replace("product_delete","product_add"),o++),fetch(r,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.text()}).then(function(e){n.innerHTML=o,a&&a()})})},bindFavButtons=function(){var e=document.getElementsByClassName("favourite_bttn"),t=document.getElementsByClassName("add_to_fav");if(e)for(var r=0;r<e.length;r++)e[r].classList.contains("js-fav")||(bindCurFavBtn(e[r]),e[r].classList.add("js-fav"));if(t&&t[0]){var n=t[0];bindCurFavBtn(n,function(){n.classList.contains("active")?n.innerHTML="Убрать из избранного":n.innerHTML="Добавить в избранное"})}};if(bindFavButtons(),catalog_sort_by_parametrs)for(var i=0;i<catalog_sort_by_parametrs.length;i++)catalog_sort_by_parametrs[i].addEventListener("click",function(e){e.preventDefault();for(var t=0;t<catalog_sort_by_parametrs.length;t++)catalog_sort_by_parametrs[t].classList.remove("active");for(var r,n=e.target,o=n.parentNode.parentNode.dataset.path,a=n.dataset.field,c=n.dataset.sort,_=n.parentNode.parentNode.parentNode.parentNode.childNodes,s=0;s<_.length;s++)if("DIV"===_[s].nodeName&&"catalog_sort_by"!==_[s].className){r=_[s];break}n.classList.add("active");var d="sorting="+a+"&by="+c;-1!==o.indexOf("?")?o+="&"+d:o+="?"+d,fetch(o,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){JSON.stringify(e);r.innerHTML=e.data,bindBuyBtn(),bindFavButtons()})});ajax_more_bttn&&0<ajax_more_bttn.length&&ajax_more_bttn[0].addEventListener("click",function(e){e.preventDefault();var t=e.target,r=1+ +t.dataset.current,n=+t.dataset.count,o=t.dataset.path,a=document.querySelector(""+t.dataset.wrapper),c=document.getElementsByClassName("page_pagination")[0];r<=n&&(t.dataset.current=r,fetch(o+="?page="+r,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){JSON.stringify(e);c.innerHTML=e.pagination,a.insertAdjacentHTML("beforeend",e.data),bindBuyBtn(),bindFavButtons()})),r==n&&(t.style.display="none")});for(var delete_from_cart_Arr=document.querySelectorAll(".delete_from_cart"),_loop=function(e){var r=delete_from_cart_Arr[e];r.addEventListener("click",function(e){e.preventDefault();var t=this.dataset.id;fetch("/basket/delete/"+t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:""}).then(function(e){return e.json()}).then(function(e){"ok"===e.status&&r.closest("tr").remove()})})},_i2=0;_i2<delete_from_cart_Arr.length;_i2++)_loop(_i2);var call_back_popup_form=document.querySelector("form.call_back_popup"),buy_in_one_click_form=document.querySelector("form.buy_in_one_click"),report_lower_form=document.querySelector("form.report_lower_popup"),order_3d_design_form=document.querySelector("form.order_3d_design_form"),cart_checkout_form=document.querySelector("form.cart_checkout_form"),sendPopupAjax=function(e,t,r,n){e.preventDefault();var o=e.target.getAttribute("action"),a=new FormData(t);fetch(o,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},body:a}).then(function(e){return e.json()}).then(function(e){"ok"===e.status?(t.innerHTML=e.result,n&&n()):document.getElementById(r).innerHTML=e.result})};buy_in_one_click_form&&buy_in_one_click_form.addEventListener("submit",function(e){sendPopupAjax(e,buy_in_one_click_form,"err_res_call_back_popup")}),call_back_popup_form&&call_back_popup_form.addEventListener("submit",function(e){sendPopupAjax(e,call_back_popup_form,"err_res_oneclickbuy_popup")}),report_lower_form&&report_lower_form.addEventListener("submit",function(e){sendPopupAjax(e,report_lower_form,"err_res_report_lower_popup")}),order_3d_design_form&&order_3d_design_form.addEventListener("submit",function(e){sendPopupAjax(e,order_3d_design_form,"err_res_order_3d_design")}),cart_checkout_form&&cart_checkout_form.addEventListener("submit",function(e){sendPopupAjax(e,cart_checkout_form,"err_res_order",function(){document.querySelector(".products_in_cart").remove()})});